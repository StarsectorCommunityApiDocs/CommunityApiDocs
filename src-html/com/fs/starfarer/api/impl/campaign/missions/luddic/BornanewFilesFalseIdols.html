<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../../dracula-javadoc8.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>package com.fs.starfarer.api.impl.campaign.missions.luddic;<a name="line.1"></a>
<span class="sourceLineNo">002</span><a name="line.2"></a>
<span class="sourceLineNo">003</span>import java.awt.Color;<a name="line.3"></a>
<span class="sourceLineNo">004</span>import java.util.List;<a name="line.4"></a>
<span class="sourceLineNo">005</span>import java.util.Map;<a name="line.5"></a>
<span class="sourceLineNo">006</span><a name="line.6"></a>
<span class="sourceLineNo">007</span>import org.lwjgl.util.vector.Vector2f;<a name="line.7"></a>
<span class="sourceLineNo">008</span><a name="line.8"></a>
<span class="sourceLineNo">009</span>import com.fs.starfarer.api.Global;<a name="line.9"></a>
<span class="sourceLineNo">010</span>import com.fs.starfarer.api.campaign.CampaignFleetAPI;<a name="line.10"></a>
<span class="sourceLineNo">011</span>import com.fs.starfarer.api.campaign.InteractionDialogAPI;<a name="line.11"></a>
<span class="sourceLineNo">012</span>import com.fs.starfarer.api.campaign.RepLevel;<a name="line.12"></a>
<span class="sourceLineNo">013</span>import com.fs.starfarer.api.campaign.SectorEntityToken;<a name="line.13"></a>
<span class="sourceLineNo">014</span>import com.fs.starfarer.api.campaign.StarSystemAPI;<a name="line.14"></a>
<span class="sourceLineNo">015</span>import com.fs.starfarer.api.campaign.econ.MarketAPI;<a name="line.15"></a>
<span class="sourceLineNo">016</span>import com.fs.starfarer.api.campaign.rules.MemoryAPI;<a name="line.16"></a>
<span class="sourceLineNo">017</span>import com.fs.starfarer.api.characters.PersonAPI;<a name="line.17"></a>
<span class="sourceLineNo">018</span>import com.fs.starfarer.api.impl.campaign.ids.Factions;<a name="line.18"></a>
<span class="sourceLineNo">019</span>import com.fs.starfarer.api.impl.campaign.ids.FleetTypes;<a name="line.19"></a>
<span class="sourceLineNo">020</span>import com.fs.starfarer.api.impl.campaign.ids.People;<a name="line.20"></a>
<span class="sourceLineNo">021</span>import com.fs.starfarer.api.impl.campaign.ids.Tags;<a name="line.21"></a>
<span class="sourceLineNo">022</span>import com.fs.starfarer.api.impl.campaign.intel.bases.LuddicPathBaseIntel;<a name="line.22"></a>
<span class="sourceLineNo">023</span>import com.fs.starfarer.api.impl.campaign.missions.hub.HubMissionWithSearch;<a name="line.23"></a>
<span class="sourceLineNo">024</span>import com.fs.starfarer.api.impl.campaign.missions.hub.ReqMode;<a name="line.24"></a>
<span class="sourceLineNo">025</span>import com.fs.starfarer.api.ui.SectorMapAPI;<a name="line.25"></a>
<span class="sourceLineNo">026</span>import com.fs.starfarer.api.ui.TooltipMakerAPI;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import com.fs.starfarer.api.util.Misc;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import com.fs.starfarer.api.util.Misc.Token;<a name="line.28"></a>
<span class="sourceLineNo">029</span><a name="line.29"></a>
<span class="sourceLineNo">030</span>public class BornanewFilesFalseIdols extends HubMissionWithSearch {<a name="line.30"></a>
<span class="sourceLineNo">031</span><a name="line.31"></a>
<span class="sourceLineNo">032</span>        public static enum Stage {<a name="line.32"></a>
<span class="sourceLineNo">033</span>                PICK_UP_BORNANEW,<a name="line.33"></a>
<span class="sourceLineNo">034</span>                MEET_MENES_YARIBAY,<a name="line.34"></a>
<span class="sourceLineNo">035</span>                ATTEND_A_PARTY,<a name="line.35"></a>
<span class="sourceLineNo">036</span>                TALK_TO_HORUS, <a name="line.36"></a>
<span class="sourceLineNo">037</span>                TALK_TO_ENGINEER,<a name="line.37"></a>
<span class="sourceLineNo">038</span>                TALK_TO_ULMUS_POND,<a name="line.38"></a>
<span class="sourceLineNo">039</span>                GO_TO_CHALCEDON,<a name="line.39"></a>
<span class="sourceLineNo">040</span>                INVESTIGATE_PATHER_STATION,<a name="line.40"></a>
<span class="sourceLineNo">041</span>                RETURN_TO_HESPERUS_EARLY,<a name="line.41"></a>
<span class="sourceLineNo">042</span>                GO_TO_HESPERUS,<a name="line.42"></a>
<span class="sourceLineNo">043</span>                ARREST_THE_CURATE,<a name="line.43"></a>
<span class="sourceLineNo">044</span>                DELIVER_KEEPFAITH,<a name="line.44"></a>
<span class="sourceLineNo">045</span>                COMPLETED,<a name="line.45"></a>
<span class="sourceLineNo">046</span>        }<a name="line.46"></a>
<span class="sourceLineNo">047</span>        <a name="line.47"></a>
<span class="sourceLineNo">048</span>        protected PersonAPI bornanew;<a name="line.48"></a>
<span class="sourceLineNo">049</span>        protected PersonAPI jaspis;  <a name="line.49"></a>
<span class="sourceLineNo">050</span>        protected PersonAPI ulmus_pond;<a name="line.50"></a>
<span class="sourceLineNo">051</span>        protected PersonAPI sedge;  <a name="line.51"></a>
<span class="sourceLineNo">052</span>        protected PersonAPI menes_yaribay;<a name="line.52"></a>
<span class="sourceLineNo">053</span>        protected PersonAPI horus_yaribay;<a name="line.53"></a>
<span class="sourceLineNo">054</span>        protected PersonAPI cedra_keepfaith;  <a name="line.54"></a>
<span class="sourceLineNo">055</span>        <a name="line.55"></a>
<span class="sourceLineNo">056</span>        protected MarketAPI asher;<a name="line.56"></a>
<span class="sourceLineNo">057</span>        protected MarketAPI chalcedon;<a name="line.57"></a>
<span class="sourceLineNo">058</span>        protected MarketAPI olinadu;<a name="line.58"></a>
<span class="sourceLineNo">059</span>        protected MarketAPI kazeron;<a name="line.59"></a>
<span class="sourceLineNo">060</span>        protected MarketAPI gilead;<a name="line.60"></a>
<span class="sourceLineNo">061</span>        protected MarketAPI hesperus;<a name="line.61"></a>
<span class="sourceLineNo">062</span>        protected MarketAPI tartessus;<a name="line.62"></a>
<span class="sourceLineNo">063</span>        protected MarketAPI bornanewLocation;<a name="line.63"></a>
<span class="sourceLineNo">064</span>        <a name="line.64"></a>
<span class="sourceLineNo">065</span>        protected StarSystemAPI patherBaseSystem;<a name="line.65"></a>
<span class="sourceLineNo">066</span>        <a name="line.66"></a>
<span class="sourceLineNo">067</span>        protected LuddicPathBaseIntel patherStation;<a name="line.67"></a>
<span class="sourceLineNo">068</span>        protected CampaignFleetAPI patherStationFleet;<a name="line.68"></a>
<span class="sourceLineNo">069</span>        <a name="line.69"></a>
<span class="sourceLineNo">070</span>        protected int stationSalvorLoss;<a name="line.70"></a>
<span class="sourceLineNo">071</span>        <a name="line.71"></a>
<span class="sourceLineNo">072</span>        <a name="line.72"></a>
<span class="sourceLineNo">073</span>        @Override<a name="line.73"></a>
<span class="sourceLineNo">074</span>        protected boolean create(MarketAPI createdAt, boolean barEvent) {<a name="line.74"></a>
<span class="sourceLineNo">075</span>                // if already accepted by the player, abort<a name="line.75"></a>
<span class="sourceLineNo">076</span>                if (!setGlobalReference("$bffi_ref", "$bffi_inProgress")) {<a name="line.76"></a>
<span class="sourceLineNo">077</span>                        return false;<a name="line.77"></a>
<span class="sourceLineNo">078</span>                }<a name="line.78"></a>
<span class="sourceLineNo">079</span>                <a name="line.79"></a>
<span class="sourceLineNo">080</span>                // Places<a name="line.80"></a>
<span class="sourceLineNo">081</span>                chalcedon = Global.getSector().getEconomy().getMarket("chalcedon");<a name="line.81"></a>
<span class="sourceLineNo">082</span>                if (chalcedon == null) return false;<a name="line.82"></a>
<span class="sourceLineNo">083</span>                if (!chalcedon.getFactionId().equals(Factions.LUDDIC_PATH)) return false;<a name="line.83"></a>
<span class="sourceLineNo">084</span>                <a name="line.84"></a>
<span class="sourceLineNo">085</span>                gilead = Global.getSector().getEconomy().getMarket("gilead");<a name="line.85"></a>
<span class="sourceLineNo">086</span>                if (gilead == null) return false;<a name="line.86"></a>
<span class="sourceLineNo">087</span>                if (!gilead.getFactionId().equals(Factions.LUDDIC_CHURCH)) return false;<a name="line.87"></a>
<span class="sourceLineNo">088</span>                <a name="line.88"></a>
<span class="sourceLineNo">089</span>                kazeron = Global.getSector().getEconomy().getMarket("kazeron");<a name="line.89"></a>
<span class="sourceLineNo">090</span>                if (kazeron == null) return false;<a name="line.90"></a>
<span class="sourceLineNo">091</span>                if (!kazeron.getFactionId().equals(Factions.PERSEAN)) return false;<a name="line.91"></a>
<span class="sourceLineNo">092</span>                <a name="line.92"></a>
<span class="sourceLineNo">093</span>                olinadu = Global.getSector().getEconomy().getMarket("olinadu");<a name="line.93"></a>
<span class="sourceLineNo">094</span>                if (olinadu == null) return false;<a name="line.94"></a>
<span class="sourceLineNo">095</span>                if (!olinadu.getFactionId().equals(Factions.PERSEAN)) return false;<a name="line.95"></a>
<span class="sourceLineNo">096</span>                <a name="line.96"></a>
<span class="sourceLineNo">097</span>                hesperus = Global.getSector().getEconomy().getMarket("hesperus");<a name="line.97"></a>
<span class="sourceLineNo">098</span>                if (hesperus == null) return false;<a name="line.98"></a>
<span class="sourceLineNo">099</span>                if (!hesperus.getFactionId().equals(Factions.LUDDIC_CHURCH)) return false;<a name="line.99"></a>
<span class="sourceLineNo">100</span>                <a name="line.100"></a>
<span class="sourceLineNo">101</span>                tartessus = Global.getSector().getEconomy().getMarket("tartessus");<a name="line.101"></a>
<span class="sourceLineNo">102</span>                if (tartessus == null) return false;<a name="line.102"></a>
<span class="sourceLineNo">103</span>                if (!tartessus.getFactionId().equals(Factions.LUDDIC_CHURCH)) return false;<a name="line.103"></a>
<span class="sourceLineNo">104</span>                <a name="line.104"></a>
<span class="sourceLineNo">105</span>                asher = Global.getSector().getEconomy().getMarket("asher");<a name="line.105"></a>
<span class="sourceLineNo">106</span>                if (asher == null) return false;<a name="line.106"></a>
<span class="sourceLineNo">107</span>                if (!asher.getFactionId().equals(Factions.LUDDIC_CHURCH)) return false;<a name="line.107"></a>
<span class="sourceLineNo">108</span>                <a name="line.108"></a>
<span class="sourceLineNo">109</span>                <a name="line.109"></a>
<span class="sourceLineNo">110</span>                // People<a name="line.110"></a>
<span class="sourceLineNo">111</span>                <a name="line.111"></a>
<span class="sourceLineNo">112</span>                bornanew = getImportantPerson(People.BORNANEW);<a name="line.112"></a>
<span class="sourceLineNo">113</span>                if (bornanew == null) return false;<a name="line.113"></a>
<span class="sourceLineNo">114</span><a name="line.114"></a>
<span class="sourceLineNo">115</span>                jaspis = getImportantPerson(People.JASPIS);<a name="line.115"></a>
<span class="sourceLineNo">116</span>                if (bornanew == null) return false;<a name="line.116"></a>
<span class="sourceLineNo">117</span>                <a name="line.117"></a>
<span class="sourceLineNo">118</span>                ulmus_pond = getImportantPerson(People.ULMUS_POND);<a name="line.118"></a>
<span class="sourceLineNo">119</span>                if (ulmus_pond == null) return false;<a name="line.119"></a>
<span class="sourceLineNo">120</span>                <a name="line.120"></a>
<span class="sourceLineNo">121</span>                menes_yaribay = getImportantPerson(People.MENES_YARIBAY);<a name="line.121"></a>
<span class="sourceLineNo">122</span>                if (menes_yaribay == null) return false;<a name="line.122"></a>
<span class="sourceLineNo">123</span>                <a name="line.123"></a>
<span class="sourceLineNo">124</span>                horus_yaribay = getImportantPerson(People.HORUS_YARIBAY);<a name="line.124"></a>
<span class="sourceLineNo">125</span>                if (horus_yaribay == null) return false;<a name="line.125"></a>
<span class="sourceLineNo">126</span>                <a name="line.126"></a>
<span class="sourceLineNo">127</span>                cedra_keepfaith = getImportantPerson(People.CEDRA_KEEPFAITH);<a name="line.127"></a>
<span class="sourceLineNo">128</span>                if (cedra_keepfaith == null) return false;<a name="line.128"></a>
<span class="sourceLineNo">129</span>                <a name="line.129"></a>
<span class="sourceLineNo">130</span>                <a name="line.130"></a>
<span class="sourceLineNo">131</span>                // Find a system to hide Pather base in<a name="line.131"></a>
<span class="sourceLineNo">132</span>                resetSearch();<a name="line.132"></a>
<span class="sourceLineNo">133</span>                requireSystemTags(ReqMode.ANY, Tags.THEME_MISC, Tags.THEME_MISC_SKIP, Tags.THEME_RUINS);<a name="line.133"></a>
<span class="sourceLineNo">134</span>                requireSystemTags(ReqMode.NOT_ANY, Tags.THEME_UNSAFE, Tags.THEME_CORE, Tags.SYSTEM_ALREADY_USED_FOR_STORY);<a name="line.134"></a>
<span class="sourceLineNo">135</span>                requireSystemNotAlreadyUsedForStory();<a name="line.135"></a>
<span class="sourceLineNo">136</span>                requireSystemNotHasPulsar(); // don't want the challenge to get blown up.<a name="line.136"></a>
<span class="sourceLineNo">137</span>                preferSystemOnFringeOfSector();<a name="line.137"></a>
<span class="sourceLineNo">138</span>                preferSystemUnexplored();<a name="line.138"></a>
<span class="sourceLineNo">139</span>                preferSystemInDirectionOfOtherMissions(); <a name="line.139"></a>
<span class="sourceLineNo">140</span>                patherBaseSystem = pickSystem();<a name="line.140"></a>
<span class="sourceLineNo">141</span>                if (patherBaseSystem == null) return false;<a name="line.141"></a>
<span class="sourceLineNo">142</span><a name="line.142"></a>
<span class="sourceLineNo">143</span>                setStoryMission();<a name="line.143"></a>
<span class="sourceLineNo">144</span>                <a name="line.144"></a>
<span class="sourceLineNo">145</span>                setStartingStage(Stage.PICK_UP_BORNANEW);<a name="line.145"></a>
<span class="sourceLineNo">146</span>                connectWithGlobalFlag(Stage.PICK_UP_BORNANEW, Stage.MEET_MENES_YARIBAY, "$bffi_goMeetMenesYaribay");<a name="line.146"></a>
<span class="sourceLineNo">147</span>                setStageOnGlobalFlag(Stage.ATTEND_A_PARTY, "$bffi_gotPartyInvite");<a name="line.147"></a>
<span class="sourceLineNo">148</span>                setStageOnGlobalFlag(Stage.TALK_TO_HORUS, "$bffi_goTalkToHorus");<a name="line.148"></a>
<span class="sourceLineNo">149</span>                setStageOnGlobalFlag(Stage.TALK_TO_ENGINEER, "$bffi_talkToEngineer");<a name="line.149"></a>
<span class="sourceLineNo">150</span>                setStageOnGlobalFlag(Stage.TALK_TO_ULMUS_POND, "$bffi_talkToUlmusPond");<a name="line.150"></a>
<span class="sourceLineNo">151</span>                setStageOnGlobalFlag(Stage.GO_TO_CHALCEDON, "$bffi_followUlmusPond");<a name="line.151"></a>
<span class="sourceLineNo">152</span>                setStageOnGlobalFlag(Stage.INVESTIGATE_PATHER_STATION, "$bffi_investigatePatherStation");<a name="line.152"></a>
<span class="sourceLineNo">153</span>                <a name="line.153"></a>
<span class="sourceLineNo">154</span>                setStageOnGlobalFlag(Stage.ARREST_THE_CURATE, "$bffi_arrestTheCurate"); // for testing.<a name="line.154"></a>
<span class="sourceLineNo">155</span>                <a name="line.155"></a>
<span class="sourceLineNo">156</span>                setStageOnGlobalFlag(Stage.RETURN_TO_HESPERUS_EARLY, "$bffi_destroyedStationEarly"); // half-failure.<a name="line.156"></a>
<span class="sourceLineNo">157</span>                <a name="line.157"></a>
<span class="sourceLineNo">158</span>                setStageOnGlobalFlag(Stage.GO_TO_HESPERUS, "$bffi_returnBornanewBody"); // definitely a failure<a name="line.158"></a>
<span class="sourceLineNo">159</span>                setStageOnGlobalFlag(Stage.GO_TO_HESPERUS, "$bffi_keepfaithEscapedTartessus"); // half-failure.<a name="line.159"></a>
<span class="sourceLineNo">160</span>                <a name="line.160"></a>
<span class="sourceLineNo">161</span>                setStageOnGlobalFlag(Stage.ARREST_THE_CURATE, "$bffi_learnedAboutKeepfaith");<a name="line.161"></a>
<span class="sourceLineNo">162</span>                setStageOnGlobalFlag(Stage.DELIVER_KEEPFAITH, "$bffi_arrestedKeepfaith");<a name="line.162"></a>
<span class="sourceLineNo">163</span>                <a name="line.163"></a>
<span class="sourceLineNo">164</span>                <a name="line.164"></a>
<span class="sourceLineNo">165</span>                setStageOnGlobalFlag(Stage.COMPLETED, "$bffi_completed");<a name="line.165"></a>
<span class="sourceLineNo">166</span>                addSuccessStages(Stage.COMPLETED);      <a name="line.166"></a>
<span class="sourceLineNo">167</span>                <a name="line.167"></a>
<span class="sourceLineNo">168</span>                makeImportant(bornanew, "$bffi_pickUpBornanew", Stage.PICK_UP_BORNANEW);<a name="line.168"></a>
<span class="sourceLineNo">169</span>                makeImportant(menes_yaribay, "$bffi_meetMenesYaribay", Stage.MEET_MENES_YARIBAY);<a name="line.169"></a>
<span class="sourceLineNo">170</span>                makeImportant(olinadu, "$bffi_attendAParty", Stage.ATTEND_A_PARTY);<a name="line.170"></a>
<span class="sourceLineNo">171</span>                makeImportant(horus_yaribay, "$bffi_talkToHorusAboutMenesParty", Stage.TALK_TO_HORUS);<a name="line.171"></a>
<span class="sourceLineNo">172</span>                <a name="line.172"></a>
<span class="sourceLineNo">173</span>                makeImportant(asher, "$bffi_talkToEngineer", Stage.TALK_TO_ENGINEER);<a name="line.173"></a>
<span class="sourceLineNo">174</span>                <a name="line.174"></a>
<span class="sourceLineNo">175</span>                makeImportant(ulmus_pond, "$bffi_talkToUlmusPond", Stage.TALK_TO_ULMUS_POND);<a name="line.175"></a>
<span class="sourceLineNo">176</span>                makeImportant(chalcedon, "$bffi_followUlmusPond", Stage.GO_TO_CHALCEDON);<a name="line.176"></a>
<span class="sourceLineNo">177</span>                <a name="line.177"></a>
<span class="sourceLineNo">178</span>                makeImportant(tartessus, "$bffi_arrestTheCurate", Stage.ARREST_THE_CURATE);<a name="line.178"></a>
<span class="sourceLineNo">179</span>                makeImportant(hesperus, "$bffi_deliverKeepfaith", Stage.DELIVER_KEEPFAITH);<a name="line.179"></a>
<span class="sourceLineNo">180</span>                <a name="line.180"></a>
<span class="sourceLineNo">181</span>                makeImportant(hesperus, "$bffi_goToHesperus", Stage.GO_TO_HESPERUS);<a name="line.181"></a>
<span class="sourceLineNo">182</span>                makeImportant(hesperus, "$bffi_goToHesperus", Stage.RETURN_TO_HESPERUS_EARLY);<a name="line.182"></a>
<span class="sourceLineNo">183</span><a name="line.183"></a>
<span class="sourceLineNo">184</span>                setName("False Idols");<a name="line.184"></a>
<span class="sourceLineNo">185</span>                setRepFactionChangesNone();<a name="line.185"></a>
<span class="sourceLineNo">186</span>                setRepPersonChangesNone();<a name="line.186"></a>
<span class="sourceLineNo">187</span>        <a name="line.187"></a>
<span class="sourceLineNo">188</span>                // Spawn a PL patrol or two to spice up things around Olinadu pre Menes' party<a name="line.188"></a>
<span class="sourceLineNo">189</span>                beginStageTrigger(Stage.ATTEND_A_PARTY);<a name="line.189"></a>
<span class="sourceLineNo">190</span>                triggerCreateFleet(FleetSize.SMALL, FleetQuality.DEFAULT, Factions.PERSEAN, FleetTypes.PATROL_MEDIUM, olinadu.getPlanetEntity());<a name="line.190"></a>
<span class="sourceLineNo">191</span>                triggerPickLocationAroundEntity(olinadu.getPlanetEntity(), 1600f);<a name="line.191"></a>
<span class="sourceLineNo">192</span>                triggerSpawnFleetAtPickedLocation("$gaDHO_arrayFleet", null);<a name="line.192"></a>
<span class="sourceLineNo">193</span>                triggerOrderFleetPatrol(false, olinadu.getPlanetEntity(), olinadu.getStarSystem().getJumpPoints().get(0));<a name="line.193"></a>
<span class="sourceLineNo">194</span>                triggerSetFleetMissionRef("$bffi_ref");<a name="line.194"></a>
<span class="sourceLineNo">195</span>                endTrigger();<a name="line.195"></a>
<span class="sourceLineNo">196</span>                <a name="line.196"></a>
<span class="sourceLineNo">197</span>                // And a couple PL patrols for after the party.<a name="line.197"></a>
<span class="sourceLineNo">198</span>                beginStageTrigger(Stage.TALK_TO_ENGINEER);<a name="line.198"></a>
<span class="sourceLineNo">199</span>                triggerCreateFleet(FleetSize.SMALL, FleetQuality.DEFAULT, Factions.PERSEAN, FleetTypes.PATROL_MEDIUM, olinadu.getPlanetEntity());<a name="line.199"></a>
<span class="sourceLineNo">200</span>                triggerFleetAllowLongPursuit();<a name="line.200"></a>
<span class="sourceLineNo">201</span>                triggerPickLocationAroundEntity(olinadu.getPlanetEntity(), 1000f);<a name="line.201"></a>
<span class="sourceLineNo">202</span>                triggerSetFleetMissionRef("$bffi_ref");<a name="line.202"></a>
<span class="sourceLineNo">203</span>                triggerSpawnFleetAtPickedLocation("$bffi_postRaidPatrol", null);<a name="line.203"></a>
<span class="sourceLineNo">204</span>                //triggerOrderFleetPatrol(false, olinadu.getPlanetEntity(), olinadu.getStarSystem().getJumpPoints().get(0), olinadu.getStarSystem().getJumpPoints().get(1));<a name="line.204"></a>
<span class="sourceLineNo">205</span>                //triggerOrderFleetInterceptPlayer(); // Could write a unique interaction, but I'd want it to have consequences... -dgb<a name="line.205"></a>
<span class="sourceLineNo">206</span>                endTrigger();<a name="line.206"></a>
<span class="sourceLineNo">207</span>                <a name="line.207"></a>
<span class="sourceLineNo">208</span>                beginStageTrigger(Stage.TALK_TO_ENGINEER);<a name="line.208"></a>
<span class="sourceLineNo">209</span>                triggerCreateFleet(FleetSize.SMALL, FleetQuality.DEFAULT, Factions.PERSEAN, FleetTypes.PATROL_MEDIUM, olinadu.getPlanetEntity());<a name="line.209"></a>
<span class="sourceLineNo">210</span>                triggerSetFleetFaction(Factions.PERSEAN);<a name="line.210"></a>
<span class="sourceLineNo">211</span>                //triggerAutoAdjustFleetStrengthMajor();<a name="line.211"></a>
<span class="sourceLineNo">212</span>                triggerPickLocationTowardsEntity(olinadu.getStarSystem().getHyperspaceAnchor(), 30f, getUnits(1.5f));<a name="line.212"></a>
<span class="sourceLineNo">213</span>                //triggerFleetAllowLongPursuit();<a name="line.213"></a>
<span class="sourceLineNo">214</span>                triggerSetFleetMissionRef("$bffi_ref");<a name="line.214"></a>
<span class="sourceLineNo">215</span>                triggerSpawnFleetAtPickedLocation("$bffi_postRaidPatrol", null);<a name="line.215"></a>
<span class="sourceLineNo">216</span>                triggerOrderFleetPatrol(false, olinadu.getPlanetEntity(), olinadu.getStarSystem().getJumpPoints().get(1));<a name="line.216"></a>
<span class="sourceLineNo">217</span>                //triggerOrderFleetInterceptPlayer(); // Could write a unique interaction, but I'd want it to have consequences... -dgb<a name="line.217"></a>
<span class="sourceLineNo">218</span>                endTrigger();<a name="line.218"></a>
<span class="sourceLineNo">219</span>                <a name="line.219"></a>
<span class="sourceLineNo">220</span>                <a name="line.220"></a>
<span class="sourceLineNo">221</span>                // Spawn a Pather fleet near Chalcedon after Pond tips them off (inadvertantly or not)<a name="line.221"></a>
<span class="sourceLineNo">222</span>                beginWithinHyperspaceRangeTrigger(chalcedon.getPlanetEntity(), 1f, false,Stage.GO_TO_CHALCEDON);<a name="line.222"></a>
<span class="sourceLineNo">223</span>                triggerCreateFleet(FleetSize.MEDIUM, FleetQuality.DEFAULT, Factions.LUDDIC_PATH, FleetTypes.PATROL_MEDIUM, chalcedon.getPlanetEntity());<a name="line.223"></a>
<span class="sourceLineNo">224</span>                triggerSetFleetFaction(Factions.LUDDIC_PATH);<a name="line.224"></a>
<span class="sourceLineNo">225</span>        triggerPickLocationAroundEntity(chalcedon.getPlanetEntity(), 800f);<a name="line.225"></a>
<span class="sourceLineNo">226</span>        triggerOrderFleetPatrol(chalcedon.getPlanetEntity());<a name="line.226"></a>
<span class="sourceLineNo">227</span>        triggerSpawnFleetAtPickedLocation("$bffi_patherGoblins", null);<a name="line.227"></a>
<span class="sourceLineNo">228</span>        triggerSetFleetMissionRef("$bffi_ref");<a name="line.228"></a>
<span class="sourceLineNo">229</span>        <a name="line.229"></a>
<span class="sourceLineNo">230</span>        // if player is hostile to Path, Path fleet is hostile to player.<a name="line.230"></a>
<span class="sourceLineNo">231</span>        if( Global.getSector().getFaction(Factions.LUDDIC_PATH).getRelToPlayer().isAtBest(RepLevel.HOSTILE)){<a name="line.231"></a>
<span class="sourceLineNo">232</span>                triggerMakeHostileAndAggressive();<a name="line.232"></a>
<span class="sourceLineNo">233</span>        }<a name="line.233"></a>
<span class="sourceLineNo">234</span>        <a name="line.234"></a>
<span class="sourceLineNo">235</span>        triggerFleetSetPatrolLeashRange(1400f);<a name="line.235"></a>
<span class="sourceLineNo">236</span>        triggerMakeFleetGoAwayAfterDefeat();<a name="line.236"></a>
<span class="sourceLineNo">237</span>        endTrigger();<a name="line.237"></a>
<span class="sourceLineNo">238</span>        <a name="line.238"></a>
<span class="sourceLineNo">239</span>                // A *serious* Luddic intercept fleet post-Chalcedon<a name="line.239"></a>
<span class="sourceLineNo">240</span>        // Revenge for killing Sedge and/or the same but stopping player's meddling.<a name="line.240"></a>
<span class="sourceLineNo">241</span>        // Maybe they demand to talk to Bornanew?<a name="line.241"></a>
<span class="sourceLineNo">242</span>                beginWithinHyperspaceRangeTrigger(chalcedon, 3f, true, Stage.INVESTIGATE_PATHER_STATION);<a name="line.242"></a>
<span class="sourceLineNo">243</span>                triggerCreateFleet(FleetSize.LARGER, FleetQuality.HIGHER, Factions.LUDDIC_PATH, FleetTypes.PATROL_LARGE, chalcedon.getLocationInHyperspace());<a name="line.243"></a>
<span class="sourceLineNo">244</span>                triggerSetFleetOfficers(OfficerNum.MORE, OfficerQuality.HIGHER);<a name="line.244"></a>
<span class="sourceLineNo">245</span>                triggerMakeHostileAndAggressive();<a name="line.245"></a>
<span class="sourceLineNo">246</span>                triggerFleetMakeFaster(true, 2, true);<a name="line.246"></a>
<span class="sourceLineNo">247</span>                triggerSetFleetAlwaysPursue();<a name="line.247"></a>
<span class="sourceLineNo">248</span>                triggerPickLocationTowardsEntity(chalcedon.getStarSystem().getHyperspaceAnchor(), 30f, getUnits(1.5f));<a name="line.248"></a>
<span class="sourceLineNo">249</span>                triggerSpawnFleetAtPickedLocation("$bffi_patherIntercept", null);<a name="line.249"></a>
<span class="sourceLineNo">250</span>                triggerOrderFleetInterceptPlayer();<a name="line.250"></a>
<span class="sourceLineNo">251</span>                triggerOrderFleetEBurn(1f);<a name="line.251"></a>
<span class="sourceLineNo">252</span>                triggerSetFleetMissionRef("$bffi_ref");<a name="line.252"></a>
<span class="sourceLineNo">253</span>                triggerFleetMakeImportant(null, Stage.INVESTIGATE_PATHER_STATION);<a name="line.253"></a>
<span class="sourceLineNo">254</span>                endTrigger();<a name="line.254"></a>
<span class="sourceLineNo">255</span>                <a name="line.255"></a>
<span class="sourceLineNo">256</span>                beginStageTrigger(Stage.COMPLETED);<a name="line.256"></a>
<span class="sourceLineNo">257</span>                triggerMakeNonStoryCritical("asher", "chalcedon", "olinadu", "kazeron", "gilead", "hesperus", "tartessus");<a name="line.257"></a>
<span class="sourceLineNo">258</span>                triggerSetGlobalMemoryValue("$bffi_missionCompleted", true);<a name="line.258"></a>
<span class="sourceLineNo">259</span>                endTrigger();<a name="line.259"></a>
<span class="sourceLineNo">260</span>                <a name="line.260"></a>
<span class="sourceLineNo">261</span>                return true;<a name="line.261"></a>
<span class="sourceLineNo">262</span>        }<a name="line.262"></a>
<span class="sourceLineNo">263</span>        <a name="line.263"></a>
<span class="sourceLineNo">264</span>        protected void updateInteractionDataImpl() {<a name="line.264"></a>
<span class="sourceLineNo">265</span>                        set("$bffi_stage", getCurrentStage());<a name="line.265"></a>
<span class="sourceLineNo">266</span>                        set("$bffi_patherStationSystem", patherBaseSystem.getName());<a name="line.266"></a>
<span class="sourceLineNo">267</span>        }<a name="line.267"></a>
<span class="sourceLineNo">268</span><a name="line.268"></a>
<span class="sourceLineNo">269</span>        @Override<a name="line.269"></a>
<span class="sourceLineNo">270</span>        protected boolean callAction(String action, String ruleId, final InteractionDialogAPI dialog,<a name="line.270"></a>
<span class="sourceLineNo">271</span>                                                                 List&lt;Token&gt; params, final Map&lt;String, MemoryAPI&gt; memoryMap) {<a name="line.271"></a>
<span class="sourceLineNo">272</span>                <a name="line.272"></a>
<span class="sourceLineNo">273</span>                if ("spawnPatherBase".equals(action)) {<a name="line.273"></a>
<span class="sourceLineNo">274</span>                        //new LuddicPathBaseIntel(patherBaseSystem,  Factions.LUDDIC_PATH);<a name="line.274"></a>
<span class="sourceLineNo">275</span>                        <a name="line.275"></a>
<span class="sourceLineNo">276</span>                        patherStation = new LuddicPathBaseIntel(patherBaseSystem, Factions.LUDDIC_PATH);<a name="line.276"></a>
<span class="sourceLineNo">277</span>                        <a name="line.277"></a>
<span class="sourceLineNo">278</span>                        <a name="line.278"></a>
<span class="sourceLineNo">279</span>                        /* Don't need to actually simulate all of this.<a name="line.279"></a>
<span class="sourceLineNo">280</span>                        patherStation.getMarket().addIndustry("heavyindustry");<a name="line.280"></a>
<span class="sourceLineNo">281</span>                        MarketAPI patherMarket = patherStation.getMarket();<a name="line.281"></a>
<span class="sourceLineNo">282</span>                        String itemId = "corrupted_nanoforge";<a name="line.282"></a>
<span class="sourceLineNo">283</span>                        InstallableItemEffect effect = ItemEffectsRepo.ITEM_EFFECTS.get(itemId);<a name="line.283"></a>
<span class="sourceLineNo">284</span>                        Industry ind = patherMarket.getIndustry("heavyindustry");<a name="line.284"></a>
<span class="sourceLineNo">285</span>                        ind.setSpecialItem(new SpecialItemData(itemId, null));<a name="line.285"></a>
<span class="sourceLineNo">286</span>                        */              <a name="line.286"></a>
<span class="sourceLineNo">287</span>                        <a name="line.287"></a>
<span class="sourceLineNo">288</span>                        MemoryAPI mem = patherStation.getEntity().getMemoryWithoutUpdate();<a name="line.288"></a>
<span class="sourceLineNo">289</span>                        mem.set("$bffi_patherStationTarget", true);<a name="line.289"></a>
<span class="sourceLineNo">290</span>                        Global.getSector().addScript(patherStation);<a name="line.290"></a>
<span class="sourceLineNo">291</span>                        <a name="line.291"></a>
<span class="sourceLineNo">292</span>                        CampaignFleetAPI patherStationFleet = Misc.getStationFleet(patherStation.getMarket());<a name="line.292"></a>
<span class="sourceLineNo">293</span>                        <a name="line.293"></a>
<span class="sourceLineNo">294</span>                        //makeImportant(patherStation, , Stage.INVESTIGATE_PATHER_STATION);<a name="line.294"></a>
<span class="sourceLineNo">295</span>                        Misc.makeImportant(patherStation.getEntity(), "$bffi_investigatePatherStation");<a name="line.295"></a>
<span class="sourceLineNo">296</span>                        Misc.addDefeatTrigger(patherStationFleet, "BFFIpatherStationDefeated");<a name="line.296"></a>
<span class="sourceLineNo">297</span>                        <a name="line.297"></a>
<span class="sourceLineNo">298</span>                        /*patherStationFleet.addEventListener(new BaseFleetEventListener() {<a name="line.298"></a>
<span class="sourceLineNo">299</span>                                @Override<a name="line.299"></a>
<span class="sourceLineNo">300</span>                                public void reportFleetDespawnedToListener(CampaignFleetAPI fleet, FleetDespawnReason reason, Object param) {<a name="line.300"></a>
<span class="sourceLineNo">301</span>                                        if (reason == FleetDespawnReason.DESTROYED_BY_BATTLE) {<a name="line.301"></a>
<span class="sourceLineNo">302</span>                                                // TODO something.<a name="line.302"></a>
<span class="sourceLineNo">303</span>                                                //fleet.getMemoryWithoutUpdate().unset("$gaATG_hegScanFleet");<a name="line.303"></a>
<span class="sourceLineNo">304</span>                                                //encounterGateHegemony.getMemoryWithoutUpdate().unset("$GAATGhegemonyScanFleet");<a name="line.304"></a>
<span class="sourceLineNo">305</span>                                        }<a name="line.305"></a>
<span class="sourceLineNo">306</span>                                }<a name="line.306"></a>
<span class="sourceLineNo">307</span>                        });*/<a name="line.307"></a>
<span class="sourceLineNo">308</span>                        return true;<a name="line.308"></a>
<span class="sourceLineNo">309</span>                }<a name="line.309"></a>
<span class="sourceLineNo">310</span>                else if ("cleanUpPatherBase".equals(action)) {<a name="line.310"></a>
<span class="sourceLineNo">311</span>                <a name="line.311"></a>
<span class="sourceLineNo">312</span>                        Misc.makeUnimportant(patherStation.getEntity(), "$bffi_investigatePatherStation"); <a name="line.312"></a>
<span class="sourceLineNo">313</span>                        // Is this implicit?<a name="line.313"></a>
<span class="sourceLineNo">314</span>                        return true;<a name="line.314"></a>
<span class="sourceLineNo">315</span>                }<a name="line.315"></a>
<span class="sourceLineNo">316</span>                else if ("patherBaseLosses".equals(action))<a name="line.316"></a>
<span class="sourceLineNo">317</span>                {<a name="line.317"></a>
<span class="sourceLineNo">318</span>                        // ui_cargo_special_tech_drop<a name="line.318"></a>
<span class="sourceLineNo">319</span>                        Global.getSoundPlayer().playSound("explosion_from_damage", 1, 1, Global.getSoundPlayer().getListenerPos(), new Vector2f());<a name="line.319"></a>
<span class="sourceLineNo">320</span>                        return true;<a name="line.320"></a>
<span class="sourceLineNo">321</span>                }<a name="line.321"></a>
<span class="sourceLineNo">322</span>                else if ("shootEm".equals(action))<a name="line.322"></a>
<span class="sourceLineNo">323</span>                {<a name="line.323"></a>
<span class="sourceLineNo">324</span>                        Global.getSoundPlayer().playSound("storyevent_diktat_execution", 1, 1, Global.getSoundPlayer().getListenerPos(), new Vector2f());<a name="line.324"></a>
<span class="sourceLineNo">325</span>                        return true;<a name="line.325"></a>
<span class="sourceLineNo">326</span>                }<a name="line.326"></a>
<span class="sourceLineNo">327</span>                else if ("ulmusPondMaskOff".equals(action)) { // unused, actually.<a name="line.327"></a>
<span class="sourceLineNo">328</span>                        ulmus_pond.setFaction("luddic_path"); // Whaaaaa????<a name="line.328"></a>
<span class="sourceLineNo">329</span>                        return true;<a name="line.329"></a>
<span class="sourceLineNo">330</span>                }<a name="line.330"></a>
<span class="sourceLineNo">331</span>                else if ("setCourseChalcedon".equals(action)) {<a name="line.331"></a>
<span class="sourceLineNo">332</span>                        Global.getSector().layInCourseFor(chalcedon.getPlanetEntity());<a name="line.332"></a>
<span class="sourceLineNo">333</span>                        return true;<a name="line.333"></a>
<span class="sourceLineNo">334</span>                }<a name="line.334"></a>
<span class="sourceLineNo">335</span>                /*else if ("transponderOff".equals(action)) {<a name="line.335"></a>
<span class="sourceLineNo">336</span>                        Global.getSector().getPlayerFleet().getAbility(Abilities.TRANSPONDER).deactivate();<a name="line.336"></a>
<span class="sourceLineNo">337</span>                        return true;<a name="line.337"></a>
<span class="sourceLineNo">338</span>                }<a name="line.338"></a>
<span class="sourceLineNo">339</span>                else if ("transponderOn".equals(action)) {<a name="line.339"></a>
<span class="sourceLineNo">340</span>                        Global.getSector().getPlayerFleet().getAbility(Abilities.TRANSPONDER).activate();<a name="line.340"></a>
<span class="sourceLineNo">341</span>                        return true;<a name="line.341"></a>
<span class="sourceLineNo">342</span>                }*/<a name="line.342"></a>
<span class="sourceLineNo">343</span>                else if ("doCleanup".equals(action))<a name="line.343"></a>
<span class="sourceLineNo">344</span>                {<a name="line.344"></a>
<span class="sourceLineNo">345</span>                        Global.getSector().getMemoryWithoutUpdate().unset("$bffi_jethroCalledOutPond");<a name="line.345"></a>
<span class="sourceLineNo">346</span>                        //Global.getSector().getMemoryWithoutUpdate().unset("$bffi_intendToTalkHorus");         <a name="line.346"></a>
<span class="sourceLineNo">347</span>                        // Jeez, anything else?<a name="line.347"></a>
<span class="sourceLineNo">348</span>                        return true;<a name="line.348"></a>
<span class="sourceLineNo">349</span>                }<a name="line.349"></a>
<span class="sourceLineNo">350</span>                <a name="line.350"></a>
<span class="sourceLineNo">351</span>                return super.callAction(action, ruleId, dialog, params, memoryMap);<a name="line.351"></a>
<span class="sourceLineNo">352</span>        }<a name="line.352"></a>
<span class="sourceLineNo">353</span>        <a name="line.353"></a>
<span class="sourceLineNo">354</span>//              if ("THEDUEL".equals(action)) {<a name="line.354"></a>
<span class="sourceLineNo">355</span>//                      TextPanelAPI text = dialog.getTextPanel();<a name="line.355"></a>
<span class="sourceLineNo">356</span>//                      text.setFontOrbitronUnnecessarilyLarge();<a name="line.356"></a>
<span class="sourceLineNo">357</span>//                      Color color = Misc.getBasePlayerColor();<a name="line.357"></a>
<span class="sourceLineNo">358</span>//                      color = Global.getSector().getFaction(Factions.HEGEMONY).getBaseUIColor();<a name="line.358"></a>
<span class="sourceLineNo">359</span>//                      text.addPara("THE DUEL", color);<a name="line.359"></a>
<span class="sourceLineNo">360</span>//                      text.setFontInsignia();<a name="line.360"></a>
<span class="sourceLineNo">361</span>//                      text.addImage("misc", "THEDUEL");<a name="line.361"></a>
<span class="sourceLineNo">362</span>//                      return true;<a name="line.362"></a>
<span class="sourceLineNo">363</span>//              }<a name="line.363"></a>
<span class="sourceLineNo">364</span>/*<a name="line.364"></a>
<span class="sourceLineNo">365</span><a name="line.365"></a>
<span class="sourceLineNo">366</span>                else if ("didMazalotRaid".equals(action))<a name="line.366"></a>
<span class="sourceLineNo">367</span>                {<a name="line.367"></a>
<span class="sourceLineNo">368</span>                        RecentUnrest.get(mazalot).add(10, "Raided Mazalot and caused a Luddic uprising");<a name="line.368"></a>
<span class="sourceLineNo">369</span>                        return true;<a name="line.369"></a>
<span class="sourceLineNo">370</span>                }*/<a name="line.370"></a>
<span class="sourceLineNo">371</span>                <a name="line.371"></a>
<span class="sourceLineNo">372</span>        <a name="line.372"></a>
<span class="sourceLineNo">373</span>        /*<a name="line.373"></a>
<span class="sourceLineNo">374</span>        @Override<a name="line.374"></a>
<span class="sourceLineNo">375</span>        public void createSmallDescription(TooltipMakerAPI info, float width, float height) {<a name="line.375"></a>
<span class="sourceLineNo">376</span>                Color h = Misc.getHighlightColor();<a name="line.376"></a>
<span class="sourceLineNo">377</span>                Color g = Misc.getGrayColor();<a name="line.377"></a>
<span class="sourceLineNo">378</span>                float pad = 3f;<a name="line.378"></a>
<span class="sourceLineNo">379</span>                float opad = 10f;<a name="line.379"></a>
<span class="sourceLineNo">380</span>                <a name="line.380"></a>
<span class="sourceLineNo">381</span>                FactionAPI faction = getFactionForUIColors();<a name="line.381"></a>
<span class="sourceLineNo">382</span>                PersonAPI person = getPerson();<a name="line.382"></a>
<span class="sourceLineNo">383</span>                <a name="line.383"></a>
<span class="sourceLineNo">384</span>                //info.addImage(Global.getSettings().getSpriteName("illustrations", "luddic_shrine"), width, opad);<a name="line.384"></a>
<span class="sourceLineNo">385</span>                <a name="line.385"></a>
<span class="sourceLineNo">386</span>                addDescriptionForCurrentStage(info, width, height);<a name="line.386"></a>
<span class="sourceLineNo">387</span>                <a name="line.387"></a>
<span class="sourceLineNo">388</span>                addBulletPoints(info, ListInfoMode.IN_DESC);<a name="line.388"></a>
<span class="sourceLineNo">389</span>        }<a name="line.389"></a>
<span class="sourceLineNo">390</span>        */<a name="line.390"></a>
<span class="sourceLineNo">391</span><a name="line.391"></a>
<span class="sourceLineNo">392</span>        @Override<a name="line.392"></a>
<span class="sourceLineNo">393</span>        public void addDescriptionForNonEndStage(TooltipMakerAPI info, float width, float height) {<a name="line.393"></a>
<span class="sourceLineNo">394</span>                float opad = 10f;<a name="line.394"></a>
<span class="sourceLineNo">395</span>                //Color h = Misc.getHighlightColor();<a name="line.395"></a>
<span class="sourceLineNo">396</span>                <a name="line.396"></a>
<span class="sourceLineNo">397</span>                //Color h2 = Misc.getDarkHighlightColor();<a name="line.397"></a>
<span class="sourceLineNo">398</span>                //FactionAPI church = Global.getSector().getFaction(Factions.LUDDIC_CHURCH);<a name="line.398"></a>
<span class="sourceLineNo">399</span>                <a name="line.399"></a>
<span class="sourceLineNo">400</span>                //info.addImage(robed_man.getPortraitSprite(), width, 128, opad);<a name="line.400"></a>
<span class="sourceLineNo">401</span><a name="line.401"></a>
<span class="sourceLineNo">402</span>                if (currentStage == Stage.PICK_UP_BORNANEW) {<a name="line.402"></a>
<span class="sourceLineNo">403</span>                        info.addPara("Pick up Jethro Bornanew from Gilead.", opad);<a name="line.403"></a>
<span class="sourceLineNo">404</span>                        addStandardMarketDesc("Go to " + gilead.getOnOrAt(), gilead, info, opad);<a name="line.404"></a>
<span class="sourceLineNo">405</span>                }<a name="line.405"></a>
<span class="sourceLineNo">406</span>                else if (currentStage == Stage.MEET_MENES_YARIBAY) {<a name="line.406"></a>
<span class="sourceLineNo">407</span>                        info.addPara("Go to Olinadu and contact Menes Yaribay, the planetary administrator.", opad);<a name="line.407"></a>
<span class="sourceLineNo">408</span>                        addStandardMarketDesc("Go to " + olinadu.getOnOrAt(), olinadu, info, opad);<a name="line.408"></a>
<span class="sourceLineNo">409</span>                }<a name="line.409"></a>
<span class="sourceLineNo">410</span>                else if (currentStage == Stage.TALK_TO_HORUS) {<a name="line.410"></a>
<span class="sourceLineNo">411</span>                        info.addPara("Go to Kazeron and talk to Horus Yaribay about his cousin Menes.", opad);<a name="line.411"></a>
<span class="sourceLineNo">412</span>                        addStandardMarketDesc("Go to " + kazeron.getOnOrAt(), kazeron, info, opad);<a name="line.412"></a>
<span class="sourceLineNo">413</span>                }<a name="line.413"></a>
<span class="sourceLineNo">414</span>                else if (currentStage == Stage.ATTEND_A_PARTY) {<a name="line.414"></a>
<span class="sourceLineNo">415</span>                        <a name="line.415"></a>
<span class="sourceLineNo">416</span>                        if(Global.getSector().getMemoryWithoutUpdate().contains("$bffi_intendToSteal")) {<a name="line.416"></a>
<span class="sourceLineNo">417</span>                                info.addPara("Attend Menes Yaribay's 'gathering' on Olinadu and find a way to steal the false relic.", opad);<a name="line.417"></a>
<span class="sourceLineNo">418</span>                                addStandardMarketDesc("Go to " + olinadu.getOnOrAt(), olinadu, info, opad);<a name="line.418"></a>
<span class="sourceLineNo">419</span>                        }<a name="line.419"></a>
<span class="sourceLineNo">420</span>                        else if(Global.getSector().getMemoryWithoutUpdate().contains("$bffi_horusToParty")) {<a name="line.420"></a>
<span class="sourceLineNo">421</span>                                info.addPara("Attend Menes Yaribay's 'gathering' on Olinadu with Horus Yaribay, the patriarch of Gens Yaribay.", opad);<a name="line.421"></a>
<span class="sourceLineNo">422</span>                                addStandardMarketDesc("Go to " + olinadu.getOnOrAt(), olinadu, info, opad);<a name="line.422"></a>
<span class="sourceLineNo">423</span>                        }<a name="line.423"></a>
<span class="sourceLineNo">424</span>                        else {<a name="line.424"></a>
<span class="sourceLineNo">425</span>                                info.addPara("Attend Menes Yaribay's 'gathering' on Olinadu and acquire the false relic.", opad);<a name="line.425"></a>
<span class="sourceLineNo">426</span>                                addStandardMarketDesc("Go to " + olinadu.getOnOrAt(), olinadu, info, opad);<a name="line.426"></a>
<span class="sourceLineNo">427</span>                        }<a name="line.427"></a>
<span class="sourceLineNo">428</span>                }<a name="line.428"></a>
<span class="sourceLineNo">429</span>                else if (currentStage == Stage.TALK_TO_ENGINEER) {<a name="line.429"></a>
<span class="sourceLineNo">430</span>                        info.addPara("Bring the false relic to Asher so that a nanoforge engineer in the employ of the Church can examine it.", opad);<a name="line.430"></a>
<span class="sourceLineNo">431</span>                        addStandardMarketDesc("Go to " + asher.getOnOrAt(), asher, info, opad);<a name="line.431"></a>
<span class="sourceLineNo">432</span>                }<a name="line.432"></a>
<span class="sourceLineNo">433</span>                else if (currentStage == Stage.TALK_TO_ULMUS_POND) {<a name="line.433"></a>
<span class="sourceLineNo">434</span>                        info.addPara("Go to Olinadu and confront Ulmus Pond to get a confession.", opad);<a name="line.434"></a>
<span class="sourceLineNo">435</span>                        addStandardMarketDesc("Go to " + asher.getOnOrAt(), asher, info, opad);<a name="line.435"></a>
<span class="sourceLineNo">436</span>                }<a name="line.436"></a>
<span class="sourceLineNo">437</span>                else if (currentStage == Stage.GO_TO_CHALCEDON) {<a name="line.437"></a>
<span class="sourceLineNo">438</span>                        info.addPara("Go to Chalcedon and use Bornanew's intel to track down where Ulmus Pond is hiding.", opad);<a name="line.438"></a>
<span class="sourceLineNo">439</span>                        addStandardMarketDesc("Go to " + chalcedon.getOnOrAt(), chalcedon, info, opad);<a name="line.439"></a>
<span class="sourceLineNo">440</span>                }<a name="line.440"></a>
<span class="sourceLineNo">441</span>                else if (currentStage == Stage.INVESTIGATE_PATHER_STATION) {<a name="line.441"></a>
<span class="sourceLineNo">442</span>                        //info.addPara("Investigate the Pather Station in the " + patherStation.getSystem().getName() + " system and try to find out where their scan of the relic came from.", opad);<a name="line.442"></a>
<span class="sourceLineNo">443</span>                        //addStandardMarketDesc("Go to the Pather station " + patherStation.getMarket().getOnOrAt(), patherStation.getMarket(), info, opad);<a name="line.443"></a>
<span class="sourceLineNo">444</span>                        info.addPara(getGoToSystemTextShort(patherStation.getMarket().getStarSystem()) + " and investigate. Find where the glove came from and how it was made. Ensure no more will be created.",opad);<a name="line.444"></a>
<span class="sourceLineNo">445</span>                }<a name="line.445"></a>
<span class="sourceLineNo">446</span>                else if (currentStage == Stage.ARREST_THE_CURATE) {<a name="line.446"></a>
<span class="sourceLineNo">447</span>                        info.addPara("Go to the Cathedral of Holy Exodus, on Tartessus, and arrest Subcurate Cedra Keepfaith.", opad);<a name="line.447"></a>
<span class="sourceLineNo">448</span>                        addStandardMarketDesc("Go to " + tartessus.getOnOrAt(), tartessus, info, opad);<a name="line.448"></a>
<span class="sourceLineNo">449</span>                }<a name="line.449"></a>
<span class="sourceLineNo">450</span>                else if (currentStage == Stage.DELIVER_KEEPFAITH) {<a name="line.450"></a>
<span class="sourceLineNo">451</span>                        info.addPara("Deliver Cedra Keepfaith to the Knights of Ludd on Hesperus to face their justice.", opad);<a name="line.451"></a>
<span class="sourceLineNo">452</span>                        addStandardMarketDesc("Go to " + hesperus.getOnOrAt(), hesperus, info, opad);<a name="line.452"></a>
<span class="sourceLineNo">453</span>                }<a name="line.453"></a>
<span class="sourceLineNo">454</span>                else if (currentStage == Stage.GO_TO_HESPERUS) {<a name="line.454"></a>
<span class="sourceLineNo">455</span>                        if(Global.getSector().getMemoryWithoutUpdate().contains("$bffi_keepfaithEscapedTartessus")){<a name="line.455"></a>
<span class="sourceLineNo">456</span>                                info.addPara("Report back to Excubitor Orbis Gideon Oak on Hesperus with news of Bornanew's quest.", opad);<a name="line.456"></a>
<span class="sourceLineNo">457</span>                                addStandardMarketDesc("Go to " + hesperus.getOnOrAt(), hesperus, info, opad);<a name="line.457"></a>
<span class="sourceLineNo">458</span>                        }<a name="line.458"></a>
<span class="sourceLineNo">459</span>                        else { //Global.getSector().getMemoryWithoutUpdate().contains("$bffi_returnBornanewBody"))<a name="line.459"></a>
<span class="sourceLineNo">460</span>                                info.addPara("Return Jethro Bornanew's body to the Knights of Ludd on Hesperus so he may rest with his fellow Knights.", opad);<a name="line.460"></a>
<span class="sourceLineNo">461</span>                                addStandardMarketDesc("Go to " + hesperus.getOnOrAt(), hesperus, info, opad);<a name="line.461"></a>
<span class="sourceLineNo">462</span>                        }<a name="line.462"></a>
<span class="sourceLineNo">463</span>                }<a name="line.463"></a>
<span class="sourceLineNo">464</span>                else if (currentStage == Stage.RETURN_TO_HESPERUS_EARLY) {<a name="line.464"></a>
<span class="sourceLineNo">465</span>                        info.addPara("Report back to Excubitor Orbis Gideon Oak on Hesperus with news of Bornanew's quest.", opad);<a name="line.465"></a>
<span class="sourceLineNo">466</span>                        addStandardMarketDesc("Go to " + hesperus.getOnOrAt(), hesperus, info, opad);<a name="line.466"></a>
<span class="sourceLineNo">467</span>                }<a name="line.467"></a>
<span class="sourceLineNo">468</span>                <a name="line.468"></a>
<span class="sourceLineNo">469</span>                /*else if (currentStage == Stage.GO_TO_MAZALOT) {<a name="line.469"></a>
<span class="sourceLineNo">470</span>                        info.addPara("A Pather, Sedge, claims that Jethro Bornanew travelled to Mazalot. Find him, or find where he has gone from there.", opad);<a name="line.470"></a>
<span class="sourceLineNo">471</span>                        addStandardMarketDesc("Go to " + mazalot.getOnOrAt(), mazalot, info, opad);<a name="line.471"></a>
<span class="sourceLineNo">472</span>                }<a name="line.472"></a>
<span class="sourceLineNo">473</span>                else if (currentStage == Stage.CONTACT_VIRENS) {<a name="line.473"></a>
<span class="sourceLineNo">474</span>                        info.addPara("Nile Virens runs the Luddic Path on Mazalot. If anyone knows where Bornanew is, it would be him or his organization. He might be persuaded to help by force or diplomacy.", opad);<a name="line.474"></a>
<span class="sourceLineNo">475</span>                        addStandardMarketDesc("Contact Nile Virens " + mazalot.getOnOrAt(), mazalot, info, opad);<a name="line.475"></a>
<span class="sourceLineNo">476</span>                        info.addImage(nile_virens.getPortraitSprite(), width, 128, opad);<a name="line.476"></a>
<span class="sourceLineNo">477</span>                        info.addImage(nile_virens.getFaction().getCrest(), width, 128, opad);<a name="line.477"></a>
<span class="sourceLineNo">478</span>                }<a name="line.478"></a>
<span class="sourceLineNo">479</span>                else if (currentStage == Stage.CONTACT_BORNANEW) {<a name="line.479"></a>
<span class="sourceLineNo">480</span>                        info.addPara("Nile Virens has provided you with the location of Jethro Bornanew, or so he claims. This consists of coordinates for a location on the surface of Mazalot, outside of a Luddic-majority settlement.", opad);<a name="line.480"></a>
<span class="sourceLineNo">481</span>                        addStandardMarketDesc("Contact Jethro Bornanew " + mazalot.getOnOrAt(), mazalot, info, opad);<a name="line.481"></a>
<span class="sourceLineNo">482</span>                        //info.addImage(bornanew.getPortraitSprite(), width, 128, opad);<a name="line.482"></a>
<span class="sourceLineNo">483</span>                }<a name="line.483"></a>
<span class="sourceLineNo">484</span>                else if (currentStage == Stage.RETURN_TO_GILEAD) {<a name="line.484"></a>
<span class="sourceLineNo">485</span>                        info.addPara("Return with Jethro Bornanew to the office of Archcurate Jaspis.", opad);<a name="line.485"></a>
<span class="sourceLineNo">486</span>                        addStandardMarketDesc("Go to " + gilead.getOnOrAt(), gilead, info, opad);<a name="line.486"></a>
<span class="sourceLineNo">487</span>                }<a name="line.487"></a>
<span class="sourceLineNo">488</span>                else if (currentStage == Stage.RETURN_TO_GILEAD2) {<a name="line.488"></a>
<span class="sourceLineNo">489</span>                        info.addPara("Return to the office of Archcurate Jaspis with news of Jethro Bornanew's 'death'.", opad);<a name="line.489"></a>
<span class="sourceLineNo">490</span>                        addStandardMarketDesc("Go to " + gilead.getOnOrAt(), gilead, info, opad);<a name="line.490"></a>
<span class="sourceLineNo">491</span>                }*/<a name="line.491"></a>
<span class="sourceLineNo">492</span>                <a name="line.492"></a>
<span class="sourceLineNo">493</span>        }<a name="line.493"></a>
<span class="sourceLineNo">494</span><a name="line.494"></a>
<span class="sourceLineNo">495</span>        @Override<a name="line.495"></a>
<span class="sourceLineNo">496</span>        public boolean addNextStepText(TooltipMakerAPI info, Color tc, float pad) {<a name="line.496"></a>
<span class="sourceLineNo">497</span>                //Color h = Misc.getHighlightColor();<a name="line.497"></a>
<span class="sourceLineNo">498</span>                <a name="line.498"></a>
<span class="sourceLineNo">499</span>                if (currentStage == Stage.PICK_UP_BORNANEW) {<a name="line.499"></a>
<span class="sourceLineNo">500</span>                        info.addPara("Send a shuttle down to pick Novice Bornanew up from Gilead", tc, pad);<a name="line.500"></a>
<span class="sourceLineNo">501</span>                        return true;<a name="line.501"></a>
<span class="sourceLineNo">502</span>                }<a name="line.502"></a>
<span class="sourceLineNo">503</span>                else if (currentStage == Stage.MEET_MENES_YARIBAY) {<a name="line.503"></a>
<span class="sourceLineNo">504</span>                        info.addPara("Go to Olinadu and talk to the administrator, Menes Yaribay", tc, pad);<a name="line.504"></a>
<span class="sourceLineNo">505</span>                        return true;<a name="line.505"></a>
<span class="sourceLineNo">506</span>                }<a name="line.506"></a>
<span class="sourceLineNo">507</span>                else if (currentStage == Stage.TALK_TO_HORUS) {<a name="line.507"></a>
<span class="sourceLineNo">508</span>                        info.addPara("Go to Kazeron and talk to Horus Yaribay about Menes", tc, pad);<a name="line.508"></a>
<span class="sourceLineNo">509</span>                        return true;<a name="line.509"></a>
<span class="sourceLineNo">510</span>                }<a name="line.510"></a>
<span class="sourceLineNo">511</span>                else if (currentStage == Stage.ATTEND_A_PARTY) {<a name="line.511"></a>
<span class="sourceLineNo">512</span>                        if(Global.getSector().getMemoryWithoutUpdate().contains("$bffi_intendToSteal")) {<a name="line.512"></a>
<span class="sourceLineNo">513</span>                                info.addPara("Attend the 'gathering' organized by Menes Yaribay on Olinadu", tc, pad);<a name="line.513"></a>
<span class="sourceLineNo">514</span>                        }<a name="line.514"></a>
<span class="sourceLineNo">515</span>                        else {<a name="line.515"></a>
<span class="sourceLineNo">516</span>                                info.addPara("Attend the 'gathering' organized by Menes Yaribay on Olinadu", tc, pad);<a name="line.516"></a>
<span class="sourceLineNo">517</span>                        }<a name="line.517"></a>
<span class="sourceLineNo">518</span>                        <a name="line.518"></a>
<span class="sourceLineNo">519</span>                        return true;<a name="line.519"></a>
<span class="sourceLineNo">520</span>                }<a name="line.520"></a>
<span class="sourceLineNo">521</span>                else if (currentStage == Stage.TALK_TO_ENGINEER) {<a name="line.521"></a>
<span class="sourceLineNo">522</span>                        info.addPara("Bring the false relic to Asher to be examined by a nanoforge engineer", tc, pad);<a name="line.522"></a>
<span class="sourceLineNo">523</span>                        return true;<a name="line.523"></a>
<span class="sourceLineNo">524</span>                }<a name="line.524"></a>
<span class="sourceLineNo">525</span>                else if (currentStage == Stage.TALK_TO_ULMUS_POND) {<a name="line.525"></a>
<span class="sourceLineNo">526</span>                        info.addPara("Go to Olinadu and talk to Ulmus Pond", tc, pad);<a name="line.526"></a>
<span class="sourceLineNo">527</span>                        return true;<a name="line.527"></a>
<span class="sourceLineNo">528</span>                }<a name="line.528"></a>
<span class="sourceLineNo">529</span>                else if (currentStage == Stage.GO_TO_CHALCEDON) {<a name="line.529"></a>
<span class="sourceLineNo">530</span>                        info.addPara("Go to Chalcedon and find Ulmus Pond", tc, pad);<a name="line.530"></a>
<span class="sourceLineNo">531</span>                        return true;<a name="line.531"></a>
<span class="sourceLineNo">532</span>                }<a name="line.532"></a>
<span class="sourceLineNo">533</span>                else if (currentStage == Stage.INVESTIGATE_PATHER_STATION) {<a name="line.533"></a>
<span class="sourceLineNo">534</span>                        info.addPara("Go to " + patherStation.getSystem().getName() + " and find the source of the 'relic'.", tc, pad);<a name="line.534"></a>
<span class="sourceLineNo">535</span>                        return true;<a name="line.535"></a>
<span class="sourceLineNo">536</span>                }<a name="line.536"></a>
<span class="sourceLineNo">537</span>                else if (currentStage == Stage.ARREST_THE_CURATE) {<a name="line.537"></a>
<span class="sourceLineNo">538</span>                        info.addPara("Go to the Cathedral of Holy Exodus on Tartessus and arrest Subcurate Cedra Keepfaith", tc, pad);<a name="line.538"></a>
<span class="sourceLineNo">539</span>                        return true;<a name="line.539"></a>
<span class="sourceLineNo">540</span>                }<a name="line.540"></a>
<span class="sourceLineNo">541</span>                else if (currentStage == Stage.DELIVER_KEEPFAITH) {<a name="line.541"></a>
<span class="sourceLineNo">542</span>                        info.addPara("Bring Cedra Keeptfaith to Hesperus to face the justice of the Knights of Ludd", tc, pad);<a name="line.542"></a>
<span class="sourceLineNo">543</span>                        return true;<a name="line.543"></a>
<span class="sourceLineNo">544</span>                }<a name="line.544"></a>
<span class="sourceLineNo">545</span>                else if (currentStage == Stage.GO_TO_HESPERUS) {<a name="line.545"></a>
<span class="sourceLineNo">546</span>                        if(Global.getSector().getMemoryWithoutUpdate().contains("$global.bffi_keepfaithEscapedTartessus"))<a name="line.546"></a>
<span class="sourceLineNo">547</span>                        {<a name="line.547"></a>
<span class="sourceLineNo">548</span>                                info.addPara("Report back to Excubitor Orbis Gideon Oak on Hesperus", tc, pad);<a name="line.548"></a>
<span class="sourceLineNo">549</span>                        }<a name="line.549"></a>
<span class="sourceLineNo">550</span>                        else { //Global.getSector().getMemoryWithoutUpdate().contains("$bffi_returnBornanewBody"))<a name="line.550"></a>
<span class="sourceLineNo">551</span>                                info.addPara("Return Jethro Bornanew's body to the Knights of Ludd on Hesperus", tc, pad);<a name="line.551"></a>
<span class="sourceLineNo">552</span>                        }<a name="line.552"></a>
<span class="sourceLineNo">553</span>                        return true;<a name="line.553"></a>
<span class="sourceLineNo">554</span>                }<a name="line.554"></a>
<span class="sourceLineNo">555</span>                else if (currentStage == Stage.RETURN_TO_HESPERUS_EARLY) {<a name="line.555"></a>
<span class="sourceLineNo">556</span>                        info.addPara("Report back to Excubitor Orbis Gideon Oak on Hesperus", tc, pad);<a name="line.556"></a>
<span class="sourceLineNo">557</span>                        return true;<a name="line.557"></a>
<span class="sourceLineNo">558</span>                }<a name="line.558"></a>
<span class="sourceLineNo">559</span>                <a name="line.559"></a>
<span class="sourceLineNo">560</span>                /*<a name="line.560"></a>
<span class="sourceLineNo">561</span>                Color h = Misc.getHighlightColor();<a name="line.561"></a>
<span class="sourceLineNo">562</span>                if (currentStage == Stage.DROP_OFF) {<a name="line.562"></a>
<span class="sourceLineNo">563</span>                        info.addPara("Deliver " + getWithoutArticle(thing) + " to specified location in the " +  <a name="line.563"></a>
<span class="sourceLineNo">564</span>                                        system.getNameWithLowercaseTypeShort(), tc, pad);<a name="line.564"></a>
<span class="sourceLineNo">565</span>                        return true;<a name="line.565"></a>
<span class="sourceLineNo">566</span>                }<a name="line.566"></a>
<span class="sourceLineNo">567</span>                */<a name="line.567"></a>
<span class="sourceLineNo">568</span>                return false;<a name="line.568"></a>
<span class="sourceLineNo">569</span>        }<a name="line.569"></a>
<span class="sourceLineNo">570</span><a name="line.570"></a>
<span class="sourceLineNo">571</span>        //@Override<a name="line.571"></a>
<span class="sourceLineNo">572</span>        //public String getBaseName() {<a name="line.572"></a>
<span class="sourceLineNo">573</span>        //      return "False Idols";<a name="line.573"></a>
<span class="sourceLineNo">574</span>        //}<a name="line.574"></a>
<span class="sourceLineNo">575</span><a name="line.575"></a>
<span class="sourceLineNo">576</span>        @Override<a name="line.576"></a>
<span class="sourceLineNo">577</span>        public String getPostfixForState() {<a name="line.577"></a>
<span class="sourceLineNo">578</span>                if (startingStage != null) {<a name="line.578"></a>
<span class="sourceLineNo">579</span>                        return "";<a name="line.579"></a>
<span class="sourceLineNo">580</span>                }<a name="line.580"></a>
<span class="sourceLineNo">581</span>                return super.getPostfixForState();<a name="line.581"></a>
<span class="sourceLineNo">582</span>        }<a name="line.582"></a>
<span class="sourceLineNo">583</span><a name="line.583"></a>
<span class="sourceLineNo">584</span>        @Override<a name="line.584"></a>
<span class="sourceLineNo">585</span>        public SectorEntityToken getMapLocation(SectorMapAPI map) {<a name="line.585"></a>
<span class="sourceLineNo">586</span>                if (patherStation != null &amp;&amp; currentStage == Stage.INVESTIGATE_PATHER_STATION) {<a name="line.586"></a>
<span class="sourceLineNo">587</span>                        return patherStation.getEntity();<a name="line.587"></a>
<span class="sourceLineNo">588</span>                }<a name="line.588"></a>
<span class="sourceLineNo">589</span>                return super.getMapLocation(map);<a name="line.589"></a>
<span class="sourceLineNo">590</span>        }<a name="line.590"></a>
<span class="sourceLineNo">591</span>}<a name="line.591"></a>
<span class="sourceLineNo">592</span><a name="line.592"></a>
<span class="sourceLineNo">593</span><a name="line.593"></a>
<span class="sourceLineNo">594</span><a name="line.594"></a>
<span class="sourceLineNo">595</span><a name="line.595"></a>
<span class="sourceLineNo">596</span><a name="line.596"></a>




























































</pre>
</div>
</body>
</html>
